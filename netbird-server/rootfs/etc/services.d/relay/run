#!/usr/bin/with-contenv bashio
# shellcheck shell=bash
set -euo pipefail

# ==============================================================================
# Home Assistant Add-on: NetBird Server
# Runs the NetBird Relay (optional)
# ==============================================================================

LOG_LEVEL=$(bashio::config 'log_level')
RELAY_EXPOSED_ADDRESS=$(bashio::config 'relay_exposed_address')
RELAY_AUTH_SECRET=$(bashio::config 'relay_auth_secret')

bashio::log.info "Starting NetBird Relay..."
exec /usr/local/bin/netbird-relay \
  --listen-address ":33080" \
  --exposed-address "$RELAY_EXPOSED_ADDRESS" \
  --auth-secret "$RELAY_AUTH_SECRET" \
  --log-level "$LOG_LEVEL" \
  --log-file console
